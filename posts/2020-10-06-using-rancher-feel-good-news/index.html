<!doctype html><html lang=en><head><meta charset=utf-8><title>Jay Vala</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Take my horse to the old town road!"><meta property="og:title" content="Using Rancher to deploy Feel Good News app backend on Kubernets"><meta property="og:description" content="Take my horse to the old town road!"><meta property="og:type" content="website"><meta property="og:url" content="https://jdvala.github.io/posts/2020-10-06-using-rancher-feel-good-news/"><meta itemprop=name content="Using Rancher to deploy Feel Good News app backend on Kubernets"><meta itemprop=description content="Take my horse to the old town road!"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using Rancher to deploy Feel Good News app backend on Kubernets"><meta name=twitter:description content="Take my horse to the old town road!"><link rel=apple-touch-icon sizes=180x180 href=apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=favicon-32.png><link rel=stylesheet href=https://jdvala.github.io/scss/style.min.d1aa507e320f63a9a89fb4d16c025955cea1564900de1060a4b2d7cabbabcdec.css></head><body><header><div class="header header-frame"><div><h1 class=header__title>Using Rancher to deploy Feel Good News app backend on Kubernets</h1><div class=header__description>Take my horse to the old town road!</div></div><nav class=header-nav><ul class="header-nav-list header-nav-list--menu"><li class=header-nav-list__item><a class=header-nav-list__link href=/about/><span>About</span></a></li></ul><button class=header-nav-list__nav-btn>navigation</button></nav><button class=mb-header__menu-btn>
<span class=mb-header__menu-btn-line></span>
<span class=mb-header__menu-btn-line></span>
<span class=mb-header__menu-btn-line></span></button></div><nav id=mobile-header-nav class=mb-header-nav><button class="mb-header-nav__close-btn flex-center"><svg class="mb-header-nav__svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/><path d="M0 0h24v24H0z" fill="none"/></svg></button><div class=mb-header-nav__wrapper><div class=mb-header-nav__container><svg width="240" height="72" viewBox="0 0 240 72" class="mb-header-nav__title"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle">Tags</text></svg><ul class=mb-header-nav-list><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=https://jdvala.github.io/tags/app/>app</a></li><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=https://jdvala.github.io/tags/rancher/>rancher</a></li><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=https://jdvala.github.io/tags/kubernetes/>kubernetes</a></li><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=https://jdvala.github.io/tags/docker/>docker</a></li><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=https://jdvala.github.io/tags/docker-swarm/>docker-swarm</a></li><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=https://jdvala.github.io/tags/orchestration/>orchestration</a></li><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=https://jdvala.github.io/tags/deployment/>deployment</a></li></ul></div><div class=mb-header-nav__container><svg width="240" height="72" viewBox="0 0 240 72" class="mb-header-nav__title"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle">Menu</text></svg><ul class=mb-header-nav-list><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=/about/>About</a></li></ul></div></div></nav></header><div id=content><article class=post><div class=post-content><blockquote><p>TL;DR: this deployment was overkill but I learned a lot. Hats off to all the DevOps out there.</p></blockquote><p>Some days ago I launched an app on both iOS and Andriod with help from a friend (frontend is not my cup of tea). The backend, however, I wrote in python. The app is based on a very simple concept, use a sentiment analysis algorithm to filter out sad, negative, and gloomy news from the news feed. The app is very rudimentary; it will show you different of news to select from and then you can scroll the feed to read the gist of news, if you like what you see from the gist, just click on the news item and it will redirect you to the original article.</p><p>The architecture of the app is very simple. It collects the news from some predefined news sources and runs sentiment analysis on them using out of the box sentiment analysis algorithm from flair&rsquo;s NLP library. If the sentiment is positive we push it to the app. Currently, the app is restricted to show news from Indian news media outlets, but plans are in place to give the user the choice to select the country that they want to get the news from, and then they can select news media outlets of their liking.</p><h2 id=installing-rancher>Installing Rancher</h2><p>Rancher is a Kubernetes management platform that makes it easier to upgrade your instances without any downtime in addition to making it easier to remotely access them(Wikipedia). It is advisable that rancher should be installed in a high availability environment, but given the fact that my application backend is not that heavy and I have a server at my home, I decided to install it using docker. Now, if I had access to my home network I would not have to worry about the security aspect of accessing the Rancher-UI, but as I am in Germany, I had to set up a DNS record on a domain and bind it to my hosts IP address. After that rancher offers a simple command to run rancher in docker with your domain name and you will have an SSL certificate setup from Let&rsquo;s Encrypt and you can access the Rancher-UI securely. Cool, very easy so far!</p><p><img src="https://github.com/jdvala/website/blob/master/img/cluster_setup.png?raw=true" alt=clustersetup></p><h2 id=setting-up-a-cluster>Setting up a cluster</h2><p>Creating a cluster on Rancher-UI is very easy as rancher makes it very convenient to separate and create node rules. As I had only one node, I had to set up my etcd, Control Plane, and Worker. One can think of etcd as the hard disk or storage space of cluster configurations in key-value form, Control Plane is the manager who spawns up pods and does all the necessary things to ensure the cluster keeps running, and lastly, a Worker as the name goes obeys what Control Plane tells it and runs the pods. Once the cluster is set up, I am ready to rock &rsquo;n&rsquo; roll (nah, not that easily).</p><p><img src="https://github.com/jdvala/website/blob/master/img/cluster_dashboard.png?raw=true" alt=clusterDashboard></p><blockquote><p>I restricted my racher docker container to only use 8 Gb of memory and 4 CPU cores.</p></blockquote><p>Deploying the backend.</p><p>Before I decided to run the backend of my app on Kubernetes, it was a process on the server, using screen (huh, what an amateur). This cannot be done on Rancher, (even if it is possible, I wouldn&rsquo;t know how), so I took the route which was most familiar to me: dockerizing the app and deploying it on Kubernetes. Quite easy (wait for it).</p><p>I created an image for my app and tested it locally but I did not want to push my image to public docker registries for when rancher needs to pull the image for deployment. So there were two options in front of me:</p><ol><li><p>Create a local docker registry and push the image to it, then setup rancher to pull the images first from the local registry and then go and look for it in the public registry.</p></li><li><p>Create a private registry on Docker Hub which provides 1 private repository, then set up the registry secret on rancher to first look for the image on my private repository. Then if it is not found there it looks in the public repositories.</p></li></ol><p>I tried option 1 but it did not work for me, so I decided to go with option number 2 (and this one is easier anyways).</p><p>Once the image was uploaded to the docker hub I could start deploying the app. Click on the deploy button on the top right corner and then fill in the details as shown below. Populate the environment variables as well as health check policies and mount the volumes if you need to store logs and other artifacts. Then press launch.</p><p><img src="https://github.com/jdvala/website/blob/master/img/deploy_app.png?raw=true" alt=DeplyApp></p><p>Rancher takes some time to set up everything and pulls the image down from my private docker repository.</p><p><img src="https://github.com/jdvala/website/blob/master/img/deployment_going.png?raw=true" alt=Deploying></p><p>Once the pods are initialized we can see the status of the container and pods.</p><p><img src="https://github.com/jdvala/website/blob/master/img/deployed.png?raw=true" alt=Deployed></p><p>Yeah! It&rsquo;s working as expected. So now, it will run and as the demand grows for the app I will increase the number of pods!</p><p>As I said earlier this was overkill but I learned a lot: the inner working of Kubernetes (though it was just the tip of the iceberg), how to deploy a service, how to set up a DNS entry, and more.</p></div></article><button class=floating-button>
<a class=floating-button__link href=https://jdvala.github.io><span>home</span></a></button></div><footer class=post-footer><div class=footer><div>© 2020, Jay Vala. Theme - Origin by Andrey Parfenov</div><div class=footer__socials><a href=www.github.com/jdvala target=_blank class=social-link title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M0 0v24h24V0H0zm14.534 19.59c-.406.078-.534-.171-.534-.384v-2.195c0-.747-.262-1.233-.55-1.481 1.782-.198 3.654-.875 3.654-3.947.0-.874-.311-1.588-.824-2.147.083-.202.357-1.016-.079-2.117.0.0-.671-.215-2.198.82-.639-.18-1.323-.267-2.003-.271-.68.003-1.364.091-2.003.269-1.528-1.035-2.2-.82-2.2-.82-.434 1.102-.16 1.915-.077 2.118-.512.56-.824 1.273-.824 2.147.0 3.064 1.867 3.751 3.645 3.954-.229.2-.436.552-.508 1.07-.457.204-1.614.557-2.328-.666.0.0-.423-.768-1.227-.825.0.0-.78-.01-.055.487.0.0.525.246.889 1.17.0.0.463 1.428 2.688.944v1.489c0 .211-.129.459-.528.385C6.292 18.533 4 15.534 4 12c0-4.419 3.582-8 8-8s8 3.581 8 8c0 3.533-2.289 6.531-5.466 7.59z"/></svg></a></div></div></footer><script src=https://jdvala.github.io/js/script.js></script></body></html>