<!doctype html><html lang=en><head><meta charset=utf-8><title>Jay Vala</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Dealing with data discrepancies"><meta property="og:title" content="Removing Data Discrepancies"><meta property="og:description" content="Dealing with data discrepancies"><meta property="og:type" content="website"><meta property="og:url" content="https://jdvala.github.io/posts/2018-05-17-removing-data-set-discrepancies/"><meta itemprop=name content="Removing Data Discrepancies"><meta itemprop=description content="Dealing with data discrepancies"><meta name=twitter:card content="summary"><meta name=twitter:title content="Removing Data Discrepancies"><meta name=twitter:description content="Dealing with data discrepancies"><link rel=apple-touch-icon sizes=180x180 href=apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=favicon-32.png><link rel=stylesheet href=https://jdvala.github.io/scss/style.min.d1aa507e320f63a9a89fb4d16c025955cea1564900de1060a4b2d7cabbabcdec.css></head><body><header><div class="header header-frame"><div><h1 class=header__title>Removing Data Discrepancies</h1><div class=header__description>Dealing with data discrepancies</div></div><nav class=header-nav><ul class="header-nav-list header-nav-list--menu"><li class=header-nav-list__item><a class=header-nav-list__link href=/about/><span>About</span></a></li></ul><button class=header-nav-list__nav-btn>navigation</button></nav><button class=mb-header__menu-btn>
<span class=mb-header__menu-btn-line></span>
<span class=mb-header__menu-btn-line></span>
<span class=mb-header__menu-btn-line></span></button></div><nav id=mobile-header-nav class=mb-header-nav><button class="mb-header-nav__close-btn flex-center"><svg class="mb-header-nav__svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/><path d="M0 0h24v24H0z" fill="none"/></svg></button><div class=mb-header-nav__wrapper><div class=mb-header-nav__container><svg width="240" height="72" viewBox="0 0 240 72" class="mb-header-nav__title"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle">Tags</text></svg><ul class=mb-header-nav-list><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=https://jdvala.github.io/tags/python/>python</a></li><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=https://jdvala.github.io/tags/text/>text</a></li><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=https://jdvala.github.io/tags/dataset/>dataset</a></li><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=https://jdvala.github.io/tags/nlp/>nlp</a></li><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=https://jdvala.github.io/tags/frustration/>frustration</a></li><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=https://jdvala.github.io/tags/data-discrepancies/>data-discrepancies</a></li></ul></div><div class=mb-header-nav__container><svg width="240" height="72" viewBox="0 0 240 72" class="mb-header-nav__title"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle">Menu</text></svg><ul class=mb-header-nav-list><li class=mb-header-nav-list__item><a class=mb-header-nav-list__link href=/about/>About</a></li></ul></div></div></nav></header><div id=content><article class=post><div class=post-content><h1 id=removing-data-set-discrepancies>Removing Data Set Discrepancies</h1><p>There were a lot of discrepancies in the dataset I created in the <a href=https://jdvala.github.io/blog.io/thesis/2018/05/15/Data-Set-Creation.html>last step</a> and I have detailed it in the most recent <a href=https://jdvala.github.io/blog.io/thesis/2018/05/16/Data-Discrepancies.html>post</a>. The most efficent way of removing those long sentences, and making them suitable for learning was making it of a fixed length.</p><p>I have used a technique called <a href=https://en.wikipedia.org/wiki/Sliding_window_protocol>Sliding Window Protocol</a> here is the brief example of how this is used here for breaking long sentences into smaller ones of fixed size.</p><p><img src="https://drive.google.com/file/d/1g-S0RW1RJ7DTB3x_ccMv4EskDdSHTY-J/view?usp=sharing" alt=slidingWindow></p><p>All the code will be the same from the <a href=https://jdvala.github.io/blog.io/thesis/2018/05/15/Data-Set-Creation.html>last step</a> but there will be a small change.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000;font-weight:700>import</span> <span style=color:#555>os</span><span style=color:#000;font-weight:700>,</span> <span style=color:#555>sys</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>import</span> <span style=color:#555>pandas</span> <span style=color:#000;font-weight:700>as</span> <span style=color:#555>pd</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>import</span> <span style=color:#555>numpy</span> <span style=color:#000;font-weight:700>as</span> <span style=color:#555>np</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#998;font-style:italic># First lets create list of topics</span>
</span></span><span style=display:flex><span>label <span style=color:#000;font-weight:700>=</span> []
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>for</span> root, dirs, files <span style=color:#000;font-weight:700>in</span> os<span style=color:#000;font-weight:700>.</span>walk(<span style=color:#d14>&#39;/home/jay/GITHUB/Data_Thesis/Ready/&#39;</span>):
</span></span><span style=display:flex><span>    label<span style=color:#000;font-weight:700>.</span>append(dirs)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#998;font-style:italic># Make a dictionary to hold the labels and corresponding category</span>
</span></span><span style=display:flex><span>labels <span style=color:#000;font-weight:700>=</span> <span style=color:#0086b3>dict</span>(<span style=color:#0086b3>list</span>(<span style=color:#0086b3>enumerate</span>(label[<span style=color:#099>0</span>])))
</span></span></code></pre></div><p>Now its time to write the sliding window function. Here the function <code>slidingWindow</code> takes three arguments, first one is the <code>sequence</code> that we desire to break, <code>winSize</code> is the desired window size(how long the sequence should be) and <code>step</code> is the number of words after the first word to the next sequence. The image above helps in clearing it out.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000;font-weight:700>def</span> <span style=color:#900;font-weight:700>slidingWindow</span>(sequence,winSize,step):
</span></span><span style=display:flex><span>    <span style=color:#d14>&#34;&#34;&#34;Returns a generator that will iterate through
</span></span></span><span style=display:flex><span><span style=color:#d14>    the defined chunks of input sequence. Input sequence
</span></span></span><span style=display:flex><span><span style=color:#d14>    must be sliceable.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#998;font-style:italic># Pre-compute number of chunks to emit</span>
</span></span><span style=display:flex><span>    numOfChunks <span style=color:#000;font-weight:700>=</span> ((<span style=color:#0086b3>len</span>(sequence)<span style=color:#000;font-weight:700>-</span>winSize)<span style=color:#000;font-weight:700>/</span>step)<span style=color:#000;font-weight:700>+</span><span style=color:#099>1</span>
</span></span><span style=display:flex><span>    <span style=color:#998;font-style:italic># Do the work</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#0086b3>range</span>(<span style=color:#099>0</span>,<span style=color:#0086b3>round</span>(numOfChunks)<span style=color:#000;font-weight:700>*</span>step,step):
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>yield</span> sequence[i:i<span style=color:#000;font-weight:700>+</span>winSize]
</span></span></code></pre></div><p><strong>NOTE:</strong> *Here I have rounded off the <code>numOfChunks</code> parameter. It is because the formula to calculate it would result into floating point numbers which can not be used in the range function. For example, if the length of sequence is 41 and <code>winSize</code> is 20 and <code>step</code> is 20 then the <code>numOfChunks</code> will be <code>((41-20)/20)+1 = 2.05</code> *</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#998;font-style:italic># Lets go through the files and take file name, dir name, and subdir name</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sent <span style=color:#000;font-weight:700>=</span> []  <span style=color:#998;font-style:italic># List to store the sentence</span>
</span></span><span style=display:flex><span>label <span style=color:#000;font-weight:700>=</span> [] <span style=color:#998;font-style:italic># List to store the label(alpha)</span>
</span></span><span style=display:flex><span>label_num <span style=color:#000;font-weight:700>=</span> []  <span style=color:#998;font-style:italic># List to store numerical label</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>for</span> root, dirs, files <span style=color:#000;font-weight:700>in</span> os<span style=color:#000;font-weight:700>.</span>walk(<span style=color:#d14>&#39;/home/jay/GITHUB/Data_Thesis/Ready/&#39;</span>):
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>for</span> file <span style=color:#000;font-weight:700>in</span> files:
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>if</span> file<span style=color:#000;font-weight:700>.</span>endswith(<span style=color:#d14>&#39;.txt&#39;</span>):
</span></span><span style=display:flex><span>            topic <span style=color:#000;font-weight:700>=</span> root<span style=color:#000;font-weight:700>.</span>split(os<span style=color:#000;font-weight:700>.</span>path<span style=color:#000;font-weight:700>.</span>sep)[<span style=color:#000;font-weight:700>-</span><span style=color:#099>2</span>]  
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>with</span> <span style=color:#0086b3>open</span>(os<span style=color:#000;font-weight:700>.</span>path<span style=color:#000;font-weight:700>.</span>join(root, file)) <span style=color:#000;font-weight:700>as</span> f:
</span></span><span style=display:flex><span>                cont <span style=color:#000;font-weight:700>=</span> f<span style=color:#000;font-weight:700>.</span>readlines()  <span style=color:#998;font-style:italic>## we prefere to get the sentences in the list form so that it is easy for us to label it</span>
</span></span><span style=display:flex><span>             
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#998;font-style:italic># Store every sentence with its corresponding labels in a list</span>
</span></span><span style=display:flex><span>                <span style=color:#998;font-style:italic># Get the label</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>for</span> key,value <span style=color:#000;font-weight:700>in</span> labels<span style=color:#000;font-weight:700>.</span>items():
</span></span><span style=display:flex><span>                    <span style=color:#000;font-weight:700>if</span> <span style=color:#0086b3>str</span>(value) <span style=color:#000;font-weight:700>==</span> <span style=color:#0086b3>str</span>(topic):      <span style=color:#998;font-style:italic># If the dir is equal to any value in the labels dict then</span>
</span></span><span style=display:flex><span>                        label_ <span style=color:#000;font-weight:700>=</span> key
</span></span><span style=display:flex><span>                        
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>                           
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>for</span> line <span style=color:#000;font-weight:700>in</span> cont:
</span></span><span style=display:flex><span>                    <span style=color:#998;font-style:italic># Checks </span>
</span></span><span style=display:flex><span>                    <span style=color:#000;font-weight:700>if</span> <span style=color:#0086b3>len</span>(line<span style=color:#000;font-weight:700>.</span>split()) <span style=color:#000;font-weight:700>&lt;=</span><span style=color:#099>5</span>:   <span style=color:#998;font-style:italic># If the sentence is less than 5 words, just ignore them</span>
</span></span><span style=display:flex><span>                        <span style=color:#000;font-weight:700>pass</span> 
</span></span><span style=display:flex><span>                    <span style=color:#000;font-weight:700>elif</span> <span style=color:#0086b3>len</span>(line<span style=color:#000;font-weight:700>.</span>split())<span style=color:#000;font-weight:700>&gt;</span><span style=color:#099>5</span> <span style=color:#000;font-weight:700>and</span> <span style=color:#0086b3>len</span>(line<span style=color:#000;font-weight:700>.</span>split())<span style=color:#000;font-weight:700>&lt;=</span><span style=color:#099>20</span>:  <span style=color:#998;font-style:italic># If its betweenn 5 and 20 just add them to dataset</span>
</span></span><span style=display:flex><span>                        sent<span style=color:#000;font-weight:700>.</span>append(line)
</span></span><span style=display:flex><span>                        label<span style=color:#000;font-weight:700>.</span>append(topic)
</span></span><span style=display:flex><span>                        label_num<span style=color:#000;font-weight:700>.</span>append(label_)
</span></span><span style=display:flex><span>                    <span style=color:#000;font-weight:700>elif</span> <span style=color:#0086b3>len</span>(line<span style=color:#000;font-weight:700>.</span>split()) <span style=color:#000;font-weight:700>&gt;</span> <span style=color:#099>20</span>:
</span></span><span style=display:flex><span>                        <span style=color:#998;font-style:italic># break the lines into 20 words each</span>
</span></span><span style=display:flex><span>                        <span style=color:#998;font-style:italic># for this I will use sliding window</span>
</span></span><span style=display:flex><span>                        slides <span style=color:#000;font-weight:700>=</span> slidingWindow(line, <span style=color:#099>20</span>, <span style=color:#099>20</span>)
</span></span><span style=display:flex><span>                        <span style=color:#000;font-weight:700>for</span> slide <span style=color:#000;font-weight:700>in</span> slides:
</span></span><span style=display:flex><span>                            sent<span style=color:#000;font-weight:700>.</span>append(slide)
</span></span><span style=display:flex><span>                            label<span style=color:#000;font-weight:700>.</span>append(topic)
</span></span><span style=display:flex><span>                            label_num<span style=color:#000;font-weight:700>.</span>append(label_)
</span></span></code></pre></div><p>Also there is a change in the way I am selecting the lines to be added in dataset. If the length of the line is smaller than or equal to 5 then I will ignore the lines, <strong>but I will not do it after the silding window, as there may be slides which have less than 5 words, I was removing it previously because it did not convey any meaning but I know for sure that after the silding window the lines will be from a bigger chunk of text which had importance so any small line from it will also be important.</strong></p></div></article><button class=floating-button>
<a class=floating-button__link href=https://jdvala.github.io><span>home</span></a></button></div><footer class=post-footer><div class=footer><div>© 2020, Jay Vala. Theme - Origin by Andrey Parfenov</div><div class=footer__socials><a href=www.github.com/jdvala target=_blank class=social-link title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M0 0v24h24V0H0zm14.534 19.59c-.406.078-.534-.171-.534-.384v-2.195c0-.747-.262-1.233-.55-1.481 1.782-.198 3.654-.875 3.654-3.947.0-.874-.311-1.588-.824-2.147.083-.202.357-1.016-.079-2.117.0.0-.671-.215-2.198.82-.639-.18-1.323-.267-2.003-.271-.68.003-1.364.091-2.003.269-1.528-1.035-2.2-.82-2.2-.82-.434 1.102-.16 1.915-.077 2.118-.512.56-.824 1.273-.824 2.147.0 3.064 1.867 3.751 3.645 3.954-.229.2-.436.552-.508 1.07-.457.204-1.614.557-2.328-.666.0.0-.423-.768-1.227-.825.0.0-.78-.01-.055.487.0.0.525.246.889 1.17.0.0.463 1.428 2.688.944v1.489c0 .211-.129.459-.528.385C6.292 18.533 4 15.534 4 12c0-4.419 3.582-8 8-8s8 3.581 8 8c0 3.533-2.289 6.531-5.466 7.59z"/></svg></a></div></div></footer><script src=https://jdvala.github.io/js/script.js></script></body></html>